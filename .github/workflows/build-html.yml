name: Conversion PDF âœ HTML uniquement

on:
  push:
    paths:
      - "plaquettes/**.pdf"
      - "scripts/convert_pdf_to_html.py"
      - ".github/workflows/convert-only.yml"

jobs:
  convert:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout du dÃ©pÃ´t
        uses: actions/checkout@v3

      - name: ğŸ Installer Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: ğŸ“¦ Installer les dÃ©pendances nÃ©cessaires
        run: |
          echo "â¬ Mise Ã  jour de pip et installation de pdf2image + pillow"
          python -m pip install --upgrade pip
          pip install pdf2image pillow

      - name: ğŸ”§ Installer Poppler (nÃ©cessaire pour pdf2image)
        run: |
          echo "ğŸ”§ Installation de poppler-utils via apt"
          sudo apt-get update && sudo apt-get install -y poppler-utils

      - name: ğŸ—‚ï¸ CrÃ©er le dossier de sortie (si absent)
        run: |
          echo "ğŸ“ CrÃ©ation du dossier html_plaquettes s'il n'existe pas"
          mkdir -p html_plaquettes

      - name: ğŸ–¨ï¸ Lancer la conversion PDF âœ HTML
        run: |
          echo "ğŸš€ Lancement du script de conversion"
          python scripts/convert_pdf_to_html.py

      - name: ğŸ” DEBUG â€“ VÃ©rification du token GH_PAT
        run: |
          if [ -z "${{ secrets.GH_PAT }}" ]; then
            echo "âŒ Le secret GH_PAT est vide ou non injectÃ©"
            exit 1
          else
            echo "âœ… Le token GH_PAT est bien injectÃ© (longueur approx): ${#{{ secrets.GH_PAT }}} caractÃ¨res"
          fi

      - name: ğŸ“¤ Commit & Push des fichiers gÃ©nÃ©rÃ©s
        run: |
          echo "ğŸ“ Configuration Git"
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          echo "ğŸ“¦ Ajout des fichiers gÃ©nÃ©rÃ©s"
          git add html_plaquettes/*.html html_plaquettes/*.png || echo "âš ï¸ Aucun fichier Ã  ajouter"

          echo "ğŸ” Diff des fichiers indexÃ©s :"
          git diff --cached || true

          echo "ğŸ§¾ Tentative de commit"
          git diff --cached --quiet || git commit -m "ğŸ–¼ï¸ Conversion PDF âœ HTML automatique"

          echo "ğŸš€ Tentative de push avec token"
          git push https://x-access-token:${{ secrets.GH_PAT }}@github.com/${{ github.repository }}.git# name: GÃ©nÃ©rer les plaquettes HTML

# name: GÃ©nÃ©rer les plaquettes HTML

# on:
#   push:
#     paths:
#       - "plaquettes/**.pdf"
#       - "scripts/*.py"
#       - "index.html"
#       - ".github/workflows/build-html.yml"

# jobs:
#   generate:
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout du dÃ©pÃ´t
#         uses: actions/checkout@v3

#       - name: Installer Python
#         uses: actions/setup-python@v4
#         with:
#           python-version: "3.11"

#       - name: Installer les dÃ©pendances Python
#         run: |
#           python -m pip install --upgrade pip
#           pip install pdf2image pillow

#       - name: Installer Poppler (pour pdf2image)
#         run: sudo apt-get update && sudo apt-get install -y poppler-utils

#       - name: CrÃ©er le dossier de sortie (si absent)
#         run: mkdir -p html_plaquettes

#       - name: GÃ©nÃ©rer les versions HTML depuis PDF
#         run: python scripts/convert_pdf_to_html.py

#       - name: Mettre Ã  jour index.html
#         run: python scripts/generate_index.py

#       - name: Commit et push des fichiers gÃ©nÃ©rÃ©s
#         run: |
#           git config user.name "GitHub Actions"
#           git config user.email "actions@github.com"
#           git add html_plaquettes/*.html html_plaquettes/*.png index.html
#           git diff --cached --quiet || git commit -m "ğŸ”„ GÃ©nÃ©ration automatique des HTML plaquettes + index"
#           git push
